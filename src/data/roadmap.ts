import type { Phase, ActionItem, Milestone } from '@/types'

// === Phases (Spec Section 2.2 + 11) ===

export const phases: Phase[] = [
  {
    id: 'phase-0',
    name: 'Immediate',
    color: '#FFB5A7',
    darkColor: '#E07A6B',
    defaultStartOffset: 0,
    defaultDuration: 7,
  },
  {
    id: 'phase-1',
    name: 'Assess + Decide',
    color: '#FCD5CE',
    darkColor: '#D4967E',
    defaultStartOffset: 7,
    defaultDuration: 8,
  },
  {
    id: 'phase-2',
    name: 'Eradication',
    color: '#D8BBFF',
    darkColor: '#9B72CF',
    defaultStartOffset: 15,
    defaultDuration: 14,
  },
  {
    id: 'phase-3',
    name: 'Restoration',
    color: '#B8F3D4',
    darkColor: '#5BBF8A',
    defaultStartOffset: 29,
    defaultDuration: 21,
  },
  {
    id: 'phase-4',
    name: 'Food Reintroduction',
    color: '#FFF3B0',
    darkColor: '#E0C44A',
    defaultStartOffset: 50,
    defaultDuration: 42,
  },
  {
    id: 'phase-5',
    name: 'Retest + Reassess',
    color: '#A2D2FF',
    darkColor: '#5B8BC9',
    defaultStartOffset: 78,
    defaultDuration: 14,
  },
  {
    id: 'phase-6',
    name: 'Optimization',
    color: '#FFAFCC',
    darkColor: '#D46A8C',
    defaultStartOffset: 92,
    defaultDuration: 90,
  },
  {
    id: 'phase-7',
    name: 'Maintenance',
    color: '#C7DFC5',
    darkColor: '#7BA87B',
    defaultStartOffset: 182,
    defaultDuration: 180,
  },
]

// === Action Items ===

export const actionItems: ActionItem[] = [
  // --- Phase 0: Immediate (Feb 13-20) ---
  {
    id: 'p0-cetirizine',
    phaseId: 'phase-0',
    milestoneId: 'ms-diagnostic-baseline',
    title: 'Start cetirizine 10mg daily (morning)',
    completed: false,
    blocksDownstream: true,
    dependsOn: [],
    category: 'medication',
  },
  {
    id: 'p0-famotidine',
    phaseId: 'phase-0',
    milestoneId: 'ms-diagnostic-baseline',
    title: 'Start famotidine 20mg BID (morning + evening)',
    completed: false,
    blocksDownstream: true,
    dependsOn: [],
    category: 'medication',
  },
  {
    id: 'p0-bloodwork',
    phaseId: 'phase-0',
    milestoneId: 'ms-diagnostic-baseline',
    title: 'Order bloodwork (CBC, CMP, ferritin, B12, TSH, A1c, CRP, quantitative immunoglobulins)',
    completed: false,
    blocksDownstream: true,
    dependsOn: [],
    category: 'test',
  },
  {
    id: 'p0-tryptase',
    phaseId: 'phase-0',
    milestoneId: 'ms-diagnostic-baseline',
    title: 'Order baseline serum tryptase (fasting)',
    completed: false,
    blocksDownstream: true,
    dependsOn: [],
    category: 'test',
  },
  {
    id: 'p0-hpylori-test',
    phaseId: 'phase-0',
    milestoneId: 'ms-diagnostic-baseline',
    title: 'Order H. pylori stool antigen test',
    completed: false,
    blocksDownstream: true,
    dependsOn: [],
    category: 'test',
  },
  {
    id: 'p0-cgm',
    phaseId: 'phase-0',
    milestoneId: 'ms-diagnostic-baseline',
    title: 'Get Freestyle Libre 3 CGM (14-day sensor)',
    completed: false,
    blocksDownstream: true,
    dependsOn: [],
    category: 'test',
  },
  {
    id: 'p0-orthostatic',
    phaseId: 'phase-0',
    milestoneId: 'ms-diagnostic-baseline',
    title: 'Perform orthostatic vitals test at home',
    completed: false,
    blocksDownstream: true,
    dependsOn: [],
    category: 'test',
  },
  {
    id: 'p0-logging',
    phaseId: 'phase-0',
    milestoneId: 'ms-diagnostic-baseline',
    title: 'Begin daily symptom logging (energy, fog, mood, flares)',
    completed: false,
    blocksDownstream: true,
    dependsOn: [],
    category: 'lifestyle',
  },

  // --- Phase 1: Assess + Decide (Feb 20-28) ---
  {
    id: 'p1-h1h2-review',
    phaseId: 'phase-1',
    milestoneId: 'ms-interpret-results',
    title: 'Review H1/H2 blocker trial results (≥50% flare reduction = positive)',
    completed: false,
    blocksDownstream: true,
    dependsOn: ['p0-cetirizine', 'p0-famotidine'],
    category: 'consultation',
  },
  {
    id: 'p1-bloodwork-review',
    phaseId: 'phase-1',
    milestoneId: 'ms-interpret-results',
    title: 'Review bloodwork results — flag abnormals',
    completed: false,
    blocksDownstream: true,
    dependsOn: ['p0-bloodwork'],
    category: 'consultation',
  },
  {
    id: 'p1-hpylori-review',
    phaseId: 'phase-1',
    milestoneId: 'ms-interpret-results',
    title: 'Review H. pylori stool antigen result',
    completed: false,
    blocksDownstream: true,
    dependsOn: ['p0-hpylori-test'],
    category: 'consultation',
  },
  {
    id: 'p1-cgm-review',
    phaseId: 'phase-1',
    milestoneId: 'ms-interpret-results',
    title: 'Review CGM data for reactive hypoglycemia',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p0-cgm'],
    category: 'consultation',
  },
  {
    id: 'p1-tryptase-review',
    phaseId: 'phase-1',
    milestoneId: 'ms-interpret-results',
    title: 'Review tryptase result',
    completed: false,
    blocksDownstream: true,
    dependsOn: ['p0-tryptase'],
    category: 'consultation',
  },
  {
    id: 'p1-go-decision',
    phaseId: 'phase-1',
    milestoneId: 'ms-interpret-results',
    title: 'Make go/no-go decision on bismuth quadruple therapy',
    completed: false,
    blocksDownstream: true,
    dependsOn: ['p1-h1h2-review', 'p1-bloodwork-review', 'p1-hpylori-review', 'p1-tryptase-review'],
    category: 'consultation',
  },

  // --- Phase 2: H. pylori Eradication (Early-Mid March, 14 days) ---
  {
    id: 'p2-prescription',
    phaseId: 'phase-2',
    milestoneId: 'ms-antibiotic-protocol',
    title: 'Get prescription for bismuth quadruple therapy',
    completed: false,
    blocksDownstream: true,
    dependsOn: ['p1-go-decision'],
    category: 'medication',
  },
  {
    id: 'p2-sboulardii',
    phaseId: 'phase-2',
    milestoneId: 'ms-antibiotic-protocol',
    title: 'Get S. boulardii probiotic',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p1-go-decision'],
    category: 'supplement',
  },
  {
    id: 'p2-hold-minerals',
    phaseId: 'phase-2',
    milestoneId: 'ms-antibiotic-protocol',
    title: 'Hold mineral supplements (multivitamin, mineral caps, magnesium) for 14 days',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p2-prescription'],
    category: 'supplement',
  },
  {
    id: 'p2-pause-ghkcu',
    phaseId: 'phase-2',
    milestoneId: 'ms-antibiotic-protocol',
    title: 'Pause GHK-Cu for 14 days',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p2-prescription'],
    category: 'peptide',
  },
  {
    id: 'p2-continue-cjc',
    phaseId: 'phase-2',
    milestoneId: 'ms-antibiotic-protocol',
    title: 'Continue CJC/Ipa unchanged',
    completed: false,
    blocksDownstream: false,
    dependsOn: [],
    category: 'peptide',
  },
  {
    id: 'p2-continue-h1h2',
    phaseId: 'phase-2',
    milestoneId: 'ms-antibiotic-protocol',
    title: 'Continue H1/H2 blockers',
    completed: false,
    blocksDownstream: false,
    dependsOn: [],
    category: 'medication',
  },
  {
    id: 'p2-daily-tracking',
    phaseId: 'phase-2',
    milestoneId: 'ms-antibiotic-protocol',
    title: 'Track daily: weight, energy, GI symptoms, brain fog',
    completed: false,
    blocksDownstream: false,
    dependsOn: [],
    category: 'lifestyle',
  },
  {
    id: 'p2-complete-course',
    phaseId: 'phase-2',
    milestoneId: 'ms-antibiotic-protocol',
    title: 'Complete 14-day antibiotic course',
    completed: false,
    blocksDownstream: true,
    dependsOn: ['p2-prescription'],
    category: 'medication',
  },
  {
    id: 'p2-weight-watch',
    phaseId: 'phase-2',
    milestoneId: 'ms-antibiotic-protocol',
    title: 'Watch weight floor (flag if <140 lbs)',
    completed: false,
    blocksDownstream: false,
    dependsOn: [],
    category: 'lifestyle',
  },

  // --- Phase 3: Early Restoration (Late March-Mid April) ---
  {
    id: 'p3-resume-ghkcu',
    phaseId: 'phase-3',
    milestoneId: 'ms-rebuild-gut',
    title: 'Resume GHK-Cu (3-5 days post-antibiotics)',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p2-complete-course'],
    category: 'peptide',
  },
  {
    id: 'p3-resume-minerals',
    phaseId: 'phase-3',
    milestoneId: 'ms-rebuild-gut',
    title: 'Resume mineral supplements',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p2-complete-course'],
    category: 'supplement',
  },
  {
    id: 'p3-continue-sboulardii',
    phaseId: 'phase-3',
    milestoneId: 'ms-rebuild-gut',
    title: 'Continue S. boulardii 1-2 more weeks',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p2-complete-course'],
    category: 'supplement',
  },
  {
    id: 'p3-butyrate',
    phaseId: 'phase-3',
    milestoneId: 'ms-rebuild-gut',
    title: 'Start butyrate supplementation',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p2-complete-course'],
    category: 'supplement',
  },
  {
    id: 'p3-sbi',
    phaseId: 'phase-3',
    milestoneId: 'ms-rebuild-gut',
    title: 'Consider SBI (MegaIgG2000)',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p2-complete-course'],
    category: 'supplement',
  },
  {
    id: 'p3-probiotic-intro',
    phaseId: 'phase-3',
    milestoneId: 'ms-rebuild-gut',
    title: 'Begin conservative probiotic introduction (one strain every 5-7 days)',
    completed: false,
    blocksDownstream: true,
    dependsOn: ['p2-complete-course'],
    category: 'supplement',
  },
  {
    id: 'p3-thymosin',
    phaseId: 'phase-3',
    milestoneId: 'ms-rebuild-gut',
    title: 'Discuss Thymosin Alpha-1 with prescribing physician',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p2-complete-course'],
    category: 'consultation',
  },

  // --- Phase 4: Food Reintroduction (Mid April-Late May) ---
  // Tier 1
  {
    id: 'p4-eggs',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Eggs',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Eggs', tier: 1 },
  },
  {
    id: 'p4-salmon',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Salmon',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Salmon', tier: 1 },
  },
  {
    id: 'p4-avocado',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Avocado',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Avocado', tier: 1 },
  },
  {
    id: 'p4-chicken',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Chicken',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Chicken', tier: 1 },
  },
  {
    id: 'p4-beef',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Beef',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Beef', tier: 1 },
  },
  {
    id: 'p4-sweet-potato',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Sweet potato',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Sweet potato', tier: 1 },
  },
  {
    id: 'p4-zucchini',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Zucchini',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Zucchini', tier: 1 },
  },
  {
    id: 'p4-olive-oil',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Olive oil',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Olive oil', tier: 1 },
  },
  {
    id: 'p4-blueberries',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Blueberries',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Blueberries', tier: 1 },
  },
  // Tier 2
  {
    id: 'p4-white-potato',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: White potato',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'White potato', tier: 2 },
  },
  {
    id: 'p4-broccoli',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Broccoli',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Broccoli', tier: 2 },
  },
  {
    id: 'p4-cauliflower',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Cauliflower',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Cauliflower', tier: 2 },
  },
  {
    id: 'p4-spinach',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Spinach',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Spinach', tier: 2 },
  },
  {
    id: 'p4-banana',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Banana',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Banana', tier: 2 },
  },
  {
    id: 'p4-apple',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Apple',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Apple', tier: 2 },
  },
  {
    id: 'p4-oats',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Oats',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Oats', tier: 2 },
  },
  // Tier 3
  {
    id: 'p4-almonds',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Almonds',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Almonds', tier: 3 },
  },
  {
    id: 'p4-pumpkin-seeds',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Pumpkin seeds',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Pumpkin seeds', tier: 3 },
  },
  {
    id: 'p4-chia-seeds',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Chia seeds',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Chia seeds', tier: 3 },
  },
  {
    id: 'p4-lettuce',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Lettuce',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Lettuce', tier: 3 },
  },
  {
    id: 'p4-ginger',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Ginger',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Ginger', tier: 3 },
  },
  {
    id: 'p4-green-tea',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Green tea',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Green tea', tier: 3 },
  },
  // Tier 4
  {
    id: 'p4-legumes',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Legumes',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Legumes', tier: 4 },
  },
  {
    id: 'p4-sesame',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Sesame',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Sesame', tier: 4 },
  },
  {
    id: 'p4-rice',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Rice',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Rice', tier: 4 },
  },
  {
    id: 'p4-octopus',
    phaseId: 'phase-4',
    milestoneId: 'ms-diet-expansion',
    title: 'Food trial: Octopus',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
    foodTrial: { food: 'Octopus', tier: 4 },
  },

  // --- Phase 5: Retest + Reassess (Mid May) ---
  {
    id: 'p5-hpylori-retest',
    phaseId: 'phase-5',
    milestoneId: 'ms-confirm-progress',
    title: 'H. pylori stool antigen retest (≥4 weeks post-antibiotics)',
    completed: false,
    blocksDownstream: true,
    dependsOn: ['p2-complete-course'],
    category: 'test',
  },
  {
    id: 'p5-hold-ppi',
    phaseId: 'phase-5',
    milestoneId: 'ms-confirm-progress',
    title: 'Hold PPI 2 weeks before retest',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p2-complete-course'],
    category: 'medication',
  },
  {
    id: 'p5-repeat-markers',
    phaseId: 'phase-5',
    milestoneId: 'ms-confirm-progress',
    title: 'Repeat sIgA and calprotectin',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p2-complete-course'],
    category: 'test',
  },
  {
    id: 'p5-cromolyn',
    phaseId: 'phase-5',
    milestoneId: 'ms-confirm-progress',
    title: 'Discuss cromolyn sodium if H1/H2 worked',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p1-h1h2-review'],
    category: 'consultation',
  },
  {
    id: 'p5-h1h2-taper',
    phaseId: 'phase-5',
    milestoneId: 'ms-confirm-progress',
    title: 'Begin H1/H2 blocker taper',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p5-hpylori-retest'],
    category: 'medication',
  },
  {
    id: 'p5-kpv',
    phaseId: 'phase-5',
    milestoneId: 'ms-confirm-progress',
    title: 'Consider KPV retry (500mcg 1-2x daily, oral enteric-coated)',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p2-complete-course'],
    category: 'peptide',
  },
  {
    id: 'p5-bpc157',
    phaseId: 'phase-5',
    milestoneId: 'ms-confirm-progress',
    title: 'Consider BPC-157 (conditional on tryptase results)',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p1-tryptase-review'],
    category: 'peptide',
  },

  // --- Phase 6: Optimization (June-August) ---
  {
    id: 'p6-food-reintro-t3',
    phaseId: 'phase-6',
    milestoneId: 'ms-expand-strengthen',
    title: 'Continue food reintroduction through Tier 3',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'diet',
  },
  {
    id: 'p6-restaurant',
    phaseId: 'phase-6',
    milestoneId: 'ms-expand-strengthen',
    title: 'Test restaurant meals (simple orders first)',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p6-food-reintro-t3'],
    category: 'diet',
  },
  {
    id: 'p6-target-weight',
    phaseId: 'phase-6',
    milestoneId: 'ms-expand-strengthen',
    title: 'Target 155 lbs',
    completed: false,
    blocksDownstream: false,
    dependsOn: [],
    category: 'lifestyle',
  },
  {
    id: 'p6-weekly-weighins',
    phaseId: 'phase-6',
    milestoneId: 'ms-expand-strengthen',
    title: 'Track weekly weigh-ins',
    completed: false,
    blocksDownstream: false,
    dependsOn: [],
    category: 'lifestyle',
  },
  {
    id: 'p6-selank',
    phaseId: 'phase-6',
    milestoneId: 'ms-expand-strengthen',
    title: 'Consider Selank if cognitive symptoms persist',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p5-hpylori-retest'],
    category: 'peptide',
  },
  {
    id: 'p6-gimap',
    phaseId: 'phase-6',
    milestoneId: 'ms-expand-strengthen',
    title: 'Repeat full GI-MAP at 6 months post-antibiotics',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p2-complete-course'],
    category: 'test',
  },

  // --- Phase 7: Long-Term Maintenance (Aug 2026-Feb 2027) ---
  {
    id: 'p7-broad-eating',
    phaseId: 'phase-7',
    milestoneId: 'ms-sustained-recovery',
    title: 'Eating broadly with confidence',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p6-restaurant'],
    category: 'diet',
  },
  {
    id: 'p7-weight-stable',
    phaseId: 'phase-7',
    milestoneId: 'ms-sustained-recovery',
    title: 'Weight stable at 155+ lbs',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p6-target-weight'],
    category: 'lifestyle',
  },
  {
    id: 'p7-illness-freq',
    phaseId: 'phase-7',
    milestoneId: 'ms-sustained-recovery',
    title: 'Illness frequency ≤4x/year',
    completed: false,
    blocksDownstream: false,
    dependsOn: [],
    category: 'lifestyle',
  },
  {
    id: 'p7-no-flares',
    phaseId: 'phase-7',
    milestoneId: 'ms-sustained-recovery',
    title: 'No regular food-triggered flares',
    completed: false,
    blocksDownstream: false,
    dependsOn: [],
    category: 'lifestyle',
  },
  {
    id: 'p7-taper-h1h2',
    phaseId: 'phase-7',
    milestoneId: 'ms-sustained-recovery',
    title: 'Taper/discontinue H1/H2 blockers',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p5-h1h2-taper'],
    category: 'medication',
  },
  {
    id: 'p7-taper-sboulardii',
    phaseId: 'phase-7',
    milestoneId: 'ms-sustained-recovery',
    title: 'Taper/discontinue S. boulardii and probiotics',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-probiotic-intro'],
    category: 'supplement',
  },
  {
    id: 'p7-taper-butyrate',
    phaseId: 'phase-7',
    milestoneId: 'ms-sustained-recovery',
    title: 'Taper/discontinue butyrate and SBI',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-butyrate'],
    category: 'supplement',
  },
  {
    id: 'p7-reassess-ta1',
    phaseId: 'phase-7',
    milestoneId: 'ms-sustained-recovery',
    title: 'Reassess Tα1 at 6 months',
    completed: false,
    blocksDownstream: false,
    dependsOn: ['p3-thymosin'],
    category: 'consultation',
  },
  {
    id: 'p7-core-stack',
    phaseId: 'phase-7',
    milestoneId: 'ms-sustained-recovery',
    title: 'Maintain core supplement stack (omega-3, D3/K2, magnesium, NAC)',
    completed: false,
    blocksDownstream: false,
    dependsOn: [],
    category: 'supplement',
  },
]

// === Milestones ===

export const milestones: Milestone[] = [
  {
    id: 'ms-diagnostic-baseline',
    phaseId: 'phase-0',
    title: 'Diagnostic Baseline',
    description: 'Start H1/H2 blockers, order all baseline labs, begin daily symptom logging.',
    actionItemIds: actionItems.filter((a) => a.milestoneId === 'ms-diagnostic-baseline').map((a) => a.id),
  },
  {
    id: 'ms-interpret-results',
    phaseId: 'phase-1',
    title: 'Interpret Results',
    description: 'Review all test results and make go/no-go decision on treatment.',
    actionItemIds: actionItems.filter((a) => a.milestoneId === 'ms-interpret-results').map((a) => a.id),
  },
  {
    id: 'ms-antibiotic-protocol',
    phaseId: 'phase-2',
    title: 'Antibiotic Protocol',
    description: 'Complete bismuth quadruple therapy for H. pylori eradication.',
    actionItemIds: actionItems.filter((a) => a.milestoneId === 'ms-antibiotic-protocol').map((a) => a.id),
  },
  {
    id: 'ms-rebuild-gut',
    phaseId: 'phase-3',
    title: 'Rebuild Gut',
    description: 'Resume supplements, start gut rebuilding protocol with probiotics and butyrate.',
    actionItemIds: actionItems.filter((a) => a.milestoneId === 'ms-rebuild-gut').map((a) => a.id),
  },
  {
    id: 'ms-diet-expansion',
    phaseId: 'phase-4',
    title: 'Systematic Diet Expansion',
    description: 'Reintroduce foods one at a time (3-4 day intervals), tracking reactions.',
    actionItemIds: actionItems.filter((a) => a.milestoneId === 'ms-diet-expansion').map((a) => a.id),
  },
  {
    id: 'ms-confirm-progress',
    phaseId: 'phase-5',
    title: 'Confirm Progress',
    description: 'Retest H. pylori, repeat markers, begin tapering medications.',
    actionItemIds: actionItems.filter((a) => a.milestoneId === 'ms-confirm-progress').map((a) => a.id),
  },
  {
    id: 'ms-expand-strengthen',
    phaseId: 'phase-6',
    title: 'Expand + Strengthen',
    description: 'Continue food expansion, target weight, consider additional peptides.',
    actionItemIds: actionItems.filter((a) => a.milestoneId === 'ms-expand-strengthen').map((a) => a.id),
  },
  {
    id: 'ms-sustained-recovery',
    phaseId: 'phase-7',
    title: 'Sustained Recovery',
    description: 'Eating broadly, weight stable, tapering off therapeutic supplements.',
    actionItemIds: actionItems.filter((a) => a.milestoneId === 'ms-sustained-recovery').map((a) => a.id),
  },
]

// Helper to get action items for a milestone
export function getActionItemsForMilestone(milestoneId: string): ActionItem[] {
  return actionItems.filter((a) => a.milestoneId === milestoneId)
}

// Helper to get milestone for a phase
export function getMilestoneForPhase(phaseId: string): Milestone | undefined {
  return milestones.find((m) => m.phaseId === phaseId)
}
